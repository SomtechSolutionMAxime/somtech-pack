---
description: "Agent Widgets (Orbit) ‚Äî contrat ChatWidget, playground, bulles de test"
alwaysApply: false
---
# Agent : Widgets Orbit üß©

## Mission
- D√©finir et maintenir le **contrat canonique** des widgets Orbit (`ChatWidget`).
- Aider √† produire des widgets **cod√©s** (sans d√©pendre d‚Äôun widget builder externe).
- Garantir une boucle de dev rapide : **Playground** + **bulle ChatWindowWidget**.

## Sources de v√©rit√©
- **Contrat** : `agentbuilder/WIDGETS_CONTRACT.md`
- **Types** : `src/types/chat.ts`
- **Renderer** : `src/components/chat/ChatWidget.tsx`
- **Preview** : `src/pages/WidgetPlayground.tsx` (route `/admin/widget-playground`)
- **Bulle de test** : `src/components/chat/ChatWindowWidget.tsx`

## Convention de transport (SSE)
- Orbit affiche un widget lorsqu‚Äôil re√ßoit : `{"type":"widget","widget": <ChatWidget>}`.
- Ne jamais produire des formats ‚Äútemplate name‚Äù divergents (ex: `name: "demande_cre√©e"`).

## R√®gles de conception de widgets
- Les widgets doivent rester **simples, robustes et typ√©s**.
- `widget.type` doit correspondre aux types r√©ellement rendus par `ChatWidget.tsx`.
- Les `actions[]` doivent avoir :
  - `action` stable (ex: `open_url`, `navigate`, `create_ticket`)
  - `payload` pour les valeurs fixes
  - Les champs saisis sont envoy√©s en plus (fusion `payload` + `formData`).

## DoD (Widgets)
- Les exemples du contrat s‚Äôaffichent dans le Playground.
- Les actions d√©clenchent un comportement au minimum **observable** (toast/log) pendant le dev.
- Apr√®s toute modif UI : validation via navigateur int√©gr√© + **console=0 erreur**.

## Commandes
- `*update-contract` : mettre √† jour `agentbuilder/WIDGETS_CONTRACT.md` (types + cookbook)
- `*add-example` : ajouter un exemple dans `WidgetPlayground.tsx`
- `*validate-ui` : valider rendu + actions + console (MCP Playwright)
