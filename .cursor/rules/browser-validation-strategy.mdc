---
alwaysApply: true
description: Strat√©gie d'utilisation du navigateur int√©gr√© MCP Playwright vs tests automatis√©s
---

# Strat√©gie de validation navigateur et tests

Ce projet utilise deux approches compl√©mentaires pour la validation d'interface :

## 1. Navigateur int√©gr√© (MCP Playwright) ‚Äî Usage interactif

**Utilisations recommand√©es** :
- ‚úÖ Validation manuelle apr√®s modification d'interface
- ‚úÖ D√©bogage d'erreurs console et r√©seau
- ‚úÖ Exploration et interaction avec l'interface
- ‚úÖ V√©rification visuelle (captures d'√©cran)
- ‚úÖ Recherche et interaction web (pages externes, veille)
- ‚úÖ Validation de comportements UI en temps r√©el
- ‚úÖ Audit d'accessibilit√© interactif

**Outils MCP Playwright √† utiliser** :
- `mcp_playwright_playwright_navigate` ‚Äî Naviguer vers une page
- `mcp_playwright_playwright_screenshot` ‚Äî Capture d'√©cran
- `mcp_playwright_playwright_click`, `mcp_playwright_playwright_fill` ‚Äî Interactions
- `mcp_playwright_playwright_console_logs` ‚Äî **Capture des erreurs console** (essentiel pour d√©bogage)
- `mcp_playwright_playwright_get_visible_html` ‚Äî Inspecter le DOM
- `mcp_playwright_playwright_evaluate` ‚Äî Ex√©cuter du JavaScript
- `mcp_playwright_playwright_close` ‚Äî Fermer le navigateur

**Quand utiliser** :
- Apr√®s toute modification de code UI (composants, pages, styles)
- Pour diagnostiquer un bug rapport√©
- Pour explorer une nouvelle fonctionnalit√©
- Pour valider visuellement un comportement
- Pour v√©rifier l'absence d'erreurs console

## 2. Tests automatis√©s Playwright ‚Äî Usage CI/CD

**Utilisations recommand√©es** :
- ‚úÖ Tests de non-r√©gression (suite e2e)
- ‚úÖ Validation automatique dans la CI/CD
- ‚úÖ Tests de parcours critiques (authentification, cr√©ation, suppression)
- ‚úÖ Tests de bout en bout multi-√©tapes

**Fichiers de test** :
- `tests/ui/**/*.spec.ts` ‚Äî Tests UI automatis√©s
- `playwright.config.ts` ‚Äî Configuration Playwright
- `page-objects/**/*.ts` ‚Äî Page Objects pour structurer les tests

**Quand cr√©er/maintenir** :
- Pour les parcours critiques m√©tier
- Pour les fonctionnalit√©s stables n√©cessitant une non-r√©gression
- Lors de la phase de stabilisation d'une feature
- Sur demande explicite de tests automatis√©s

## R√®gles de priorisation

### ‚ö†Ô∏è TOUJOURS FAIRE (OBLIGATOIRE - aucune exception) :
1. **Apr√®s chaque modification UI** ‚Üí Utiliser le navigateur MCP Playwright
2. **üî¥ OBLIGATOIRE : Capturer les logs console** (`playwright_console_logs` type: "error") apr√®s chaque modification UI
3. **üî¥ OBLIGATOIRE : Confirmer 0 erreur console** avant de consid√©rer la t√¢che termin√©e
4. **Si erreurs d√©tect√©es** ‚Üí Corriger ‚Üí RE-CAPTURER console ‚Üí Confirmer 0 erreur
5. **En cas de bug** ‚Üí Capturer d'abord les logs console (`playwright_console_logs`)
6. **Avant de valider une PR** ‚Üí V√©rifier visuellement les changements via MCP + confirmer 0 erreur console

### Optionnel mais recommand√© (tests automatis√©s) :
1. Tests e2e pour parcours critiques (auth, CRUD principal)
2. Tests de non-r√©gression sur features stables
3. Tests automatis√©s si requis par la DoD ou le QA

## Workflow type

### Modification UI (Frontend, UX/UI)
```
1. Modifier le code (composant, page, style)
2. Lancer `npm run dev` (Vite sur http://localhost:5173)
3. Utiliser MCP Playwright :
   - Naviguer vers la page modifi√©e
   - Interagir avec les √©l√©ments
   - üî¥ OBLIGATOIRE : Capturer les logs console (console_logs type: "error")
   - üî¥ OBLIGATOIRE : Confirmer 0 erreur console
   - Capturer des screenshots
4. Si erreurs d√©tect√©es ‚Üí Corriger le code IMM√âDIATEMENT
5. üî¥ OBLIGATOIRE : Recharger la page et RE-CAPTURER les logs console
6. üî¥ OBLIGATOIRE : Confirmer 0 erreur avant de continuer
7. R√©p√©ter 4-6 jusqu'√† validation compl√®te (0 erreur console)
8. (Optionnel) Ajouter/mettre √† jour un test automatis√© si parcours critique

‚ö†Ô∏è NE PAS TERMINER LA T√ÇCHE SANS AVOIR V√âRIFI√â LA CONSOLE ET CONFIRM√â 0 ERREUR
```

### D√©bogage d'erreur console

#### Cas 1 : Erreur d√©tect√©e pendant les tests (copie-coll√©e par l'utilisateur)
**‚ö†Ô∏è R√àGLE OBLIGATOIRE** : Quand l'utilisateur copie-colle une erreur console d√©tect√©e pendant ses tests, apr√®s correction, vous **DEVEZ** automatiquement revalider avec les tests UI pour confirmer que l'erreur ne se reproduit plus.

```
1. Utilisateur copie-colle une erreur console (ex: erreur POST, erreur r√©seau, erreur JS)
2. Analyser l'erreur (stack trace, messages, contexte)
3. Identifier la cause et corriger le code
4. **OBLIGATOIRE** : Revalider automatiquement avec les tests UI :
   a. Naviguer vers la page concern√©e : `playwright_navigate`
   b. Reproduire le sc√©nario qui d√©clenchait l'erreur (clics, formulaires, interactions)
   c. Capturer les logs console : `playwright_console_logs` (type: "error")
   d. **Confirmer que l'erreur ne se reproduit plus** (0 erreur attendue)
5. Si l'erreur persiste ‚Üí it√©rer (corriger ‚Üí revalider) jusqu'√† r√©solution
6. Documenter la correction et la validation dans la PR/commit
```

**Objectif** : √âviter que l'utilisateur doive copier-coller la m√™me erreur plusieurs fois. La correction doit √™tre valid√©e imm√©diatement.

#### Cas 2 : Erreur d√©tect√©e proactivement par l'agent
```
1. Utiliser MCP Playwright : `playwright_navigate` vers la page concern√©e
2. Capturer les logs : `playwright_console_logs` (type: "error")
3. Analyser les erreurs (stack trace, messages)
4. Corriger le code
5. Recharger la page et RE-CAPTURER les logs pour confirmer 0 erreur
6. Documenter la correction dans la PR/commit
```

### Recherche/interaction web
```
1. Utiliser MCP Playwright pour naviguer vers des sites externes
2. Interagir, capturer, analyser
3. Utiliser `mcp_pure_md_unblock-url` si besoin de contenu Markdown propre
4. Ne PAS utiliser les tests automatis√©s pour cela
```

## R√©f√©rences
- Guide MCP Playwright : `docs/mcp/MDC_Serveur_MCP_Somtech_Cursor_Fly_Supabase.md`
- Tests automatis√©s : `tests/ui/README.md` (si existe)
- Configuration : `playwright.config.ts`

## R√©sum√©

| Besoin | Outil | Commande |
|--------|-------|----------|
| Validation UI apr√®s modif | MCP Playwright | `mcp_playwright_playwright_*` |
| Capture erreurs console | MCP Playwright | `playwright_console_logs` |
| Interaction/exploration | MCP Playwright | `navigate`, `click`, `screenshot` |
| Recherche web | MCP Playwright + pure.md | `navigate` ou `mcp_pure_md_*` |
| Tests automatis√©s e2e | Playwright local | `npx playwright test` |
| CI/CD non-r√©gression | Playwright local | Suite dans `tests/ui/` |
