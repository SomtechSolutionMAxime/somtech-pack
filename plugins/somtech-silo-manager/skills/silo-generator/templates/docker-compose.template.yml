# SomTech Silo — {CLIENT_SLUG}-{APP_SLUG}
# Generated by /generate-silo on {DATE}
# DO NOT EDIT MANUALLY — regenerate with /generate-silo

version: "3.8"

networks:
  silo-{CLIENT_SLUG}-{APP_SLUG}-net:
    driver: bridge

x-common-env: &common-env
  SILO_CLIENT_SLUG: {CLIENT_SLUG}
  SILO_APP_SLUG: {APP_SLUG}
  SOMTECH_DESK_URL: https://vdpuktsqrecdxbmweate.supabase.co/functions/v1/servicedesk-mcp/sse
  SOMTECH_DESK_API_KEY: ${SOMTECH_DESK_API_KEY}

services:
  clientele:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-clientele
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: clientele
      CONSTITUTION_PATH: /config/constitutions/clientele.md
      COMMUNICATION_LANGUAGE: {COMMUNICATION_LANGUAGE}
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  dev-orchestrator:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-dev-orchestrator
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: dev-orchestrator
      CONSTITUTION_PATH: /config/constitutions/dev-orchestrator.md
      REPO_URL: {REPO_URL}
      SILO_BRANCH: {SILO_BRANCH}
      DEFAULT_BRANCH: {DEFAULT_BRANCH}
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  dev-worker-1:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-dev-worker-1
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: dev-worker
      AGENT_INSTANCE: "1"
      CONSTITUTION_PATH: /config/constitutions/dev-worker.md
      REPO_URL: {REPO_URL}
      SILO_BRANCH: {SILO_BRANCH}
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  dev-worker-2:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-dev-worker-2
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: dev-worker
      AGENT_INSTANCE: "2"
      CONSTITUTION_PATH: /config/constitutions/dev-worker.md
      REPO_URL: {REPO_URL}
      SILO_BRANCH: {SILO_BRANCH}
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  security-auditor:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-security-auditor
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: security-auditor
      CONSTITUTION_PATH: /config/constitutions/security-auditor.md
      SCAN_SCHEDULE: "0 2 * * *"
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  security-validator:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-security-validator
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: security-validator
      CONSTITUTION_PATH: /config/constitutions/security-validator.md
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped

  devops:
    container_name: silo-{CLIENT_SLUG}-{APP_SLUG}-devops
    image: somtech/agent:latest
    environment:
      <<: *common-env
      AGENT_ROLE: devops
      CONSTITUTION_PATH: /config/constitutions/devops.md
      REPO_URL: {REPO_URL}
      SILO_BRANCH: {SILO_BRANCH}
      DEFAULT_BRANCH: {DEFAULT_BRANCH}
      FLY_ORG: {FLY_ORG}
      FLY_REGION: {FLY_REGION}
      NETLIFY_SITE_ID: {SITE_ID}
      NETLIFY_AUTH_TOKEN: ${NETLIFY_AUTH_TOKEN}
      SUPABASE_ACCESS_TOKEN: ${SUPABASE_ACCESS_TOKEN}
    volumes:
      - ./constitutions:/config/constitutions:ro
    networks:
      - silo-{CLIENT_SLUG}-{APP_SLUG}-net
    restart: unless-stopped
